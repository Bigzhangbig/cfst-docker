# 轨道规范：添加定时测速功能

## 1. 概述
本轨道旨在为 `cfst-docker` 引入自动化的定时运行机制，使其能够作为一个长期运行的后台服务（Daemon），定期执行 Cloudflare 速度测试并自动同步至 Gist。

## 2. 功能需求
- **多模式运行机制：**
    - **单次模式 (One-shot)：** 维持现有逻辑，运行完即退出。
    - **循环模式 (Loop)：** 通过环境变量 `LOOP_INTERVAL`（如 `600` 秒）触发，使用 `while sleep` 循环执行。
    - **定时模式 (Cron)：** 通过环境变量 `CRON`（如 `0 * * * *`）触发，在容器内启动 `crond` 服务并执行任务。
- **结果管理：**
    - **Gist 覆盖更新：** 每次定时运行完成后，自动更新指定的 Gist 文件，始终保持展示最新的前 20 条优质 IP。
    - **日志自动轮转：** 引入简单的日志清理逻辑，防止 `speedtest.log` 在长期运行模式下占用过多空间。
- **配置增强：**
    - 支持新的环境变量：`CRON`, `LOOP_INTERVAL`。
    - 优化 `entrypoint.sh` 逻辑，实现上述模式的自动切换。

## 3. 非功能需求
- **轻量化：** 使用 Alpine 自带的 `busybox crond`，不引入额外的笨重依赖。
- **鲁棒性：** 在 Cron 模式下，确保测速任务失败不会导致守护进程崩溃。
- **透明度：** 每次定时任务启动和结束时，都在日志中记录明确的时间戳和状态。

## 4. 验收标准
- [ ] 设置 `LOOP_INTERVAL=10` 时，容器能每隔 10 秒（测试用，实际使用建议更长）执行一次测速。
- [ ] 设置 `CRON="*/5 * * * *"` 时，`crond` 进程正常启动，并在第 5 分钟执行测速。
- [ ] 在长期运行（如循环 10 次）后，`speedtest.log` 的大小被限制在合理范围内（例如保留最后 1000 行）。
- [ ] Gist 成功同步最新结果，且旧结果被覆盖。
- [ ] Docker `HEALTHCHECK` 能够正确反映守护进程的运行状态。

## 5. 范围之外
- 不支持多个不同的 Cron 任务（仅支持一个测速主任务）。
- 不支持 Web UI 配置界面，所有配置仍通过环境变量完成。
